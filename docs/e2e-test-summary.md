# E2Eテスト仕様書

このドキュメントは、新しく実装されたE2Eテストの概要、テスト手順、期待値をまとめたものです。

---

## 1. 認証フロー（auth.spec.ts）

### TC-AUTH-001: ログイン成功
**概要**: 正しい認証情報でログインし、ダッシュボードへ遷移することを確認

**手順**:
1. ログインページ（`/login`）に移動
2. ログインフォーム（メール入力、パスワード入力、ログインボタン）が表示されることを確認
3. 正しいメールアドレスとパスワードを入力
4. ログインボタンをクリック
5. ダッシュボード（`/dashboard`）にリダイレクトされることを確認

**期待値**: ダッシュボードのカレンダーが表示される

---

### TC-AUTH-002: ログイン失敗
**概要**: 間違ったパスワードでログインを試み、エラーメッセージが表示されることを確認

**手順**:
1. ログインページに移動
2. 正しいメールアドレスと間違ったパスワード（`wrong-password-123`）を入力
3. ログインボタンをクリック
4. エラーメッセージ（赤い背景）が表示されることを確認
5. ログインページに留まっていることを確認

**期待値**: エラーメッセージが表示され、URLに`/login`が含まれる

---

### TC-AUTH-003: ログアウト
**概要**: ログアウト操作後、ログイン画面にリダイレクトされることを確認

**手順**:
1. ログイン状態でダッシュボードに移動
2. ヘッダーのユーザーメニューボタンをクリック
3. ログアウトボタンをクリック
4. ログインページにリダイレクトされることを確認
5. ログインフォームが表示されることを確認

**期待値**: URLに`/login`が含まれ、ログインフォームが表示される

---

### TC-AUTH-004: 未認証アクセス制御
**概要**: 未認証ユーザーが保護ページにアクセスした際、ログイン画面にリダイレクトされることを確認

**手順**:
1. ログインせずにダッシュボード（`/dashboard`）に直接アクセス
2. ログインページにリダイレクトされることを確認
3. マイページ（`/mypage`）にも同様にアクセスし、リダイレクトを確認

**期待値**: 保護ページへのアクセス時、URLに`/login`が含まれる

---

### TC-AUTH-005: サインアップ
**概要**: 新規ユーザー登録フローが正しく動作することを確認

**手順**:
1. サインアップページ（`/signup`）に移動
2. サインアップフォーム（名前、メール、パスワード、サインアップボタン）が表示されることを確認
3. テスト用のユーザー情報を入力
4. サインアップボタンをクリック
5. ダッシュボードのカレンダーが表示されることを確認

**期待値**: ダッシュボードのカレンダーが表示される

---

### TC-AUTH-006: パスワードリセット
**概要**: パスワードリセットメール送信フローが動作することを確認

**手順**:
1. ログインページに移動
2. 「パスワードを忘れた」リンクをクリック
3. パスワードリセットページ（`/reset-password`）に遷移することを確認
4. メールアドレス入力フォームが表示されることを確認
5. メールアドレスを入力してリセットメールを送信
6. 送信成功メッセージが表示されることを確認

**期待値**: 緑色の成功メッセージに「パスワードリセット用のメールを送信しました」と表示される

---

### TC-AUTH-007: ログインモード切り替え
**概要**: ログイン↔サインアップモードの切り替えが正しく動作することを確認

**手順**:
1. ログインページに移動
2. ログインフォームが表示されることを確認
3. モード切り替えボタンをクリック
4. サインアップフォームに切り替わることを確認
5. 再度モード切り替えボタンをクリック
6. ログインフォームに戻ることを確認

**期待値**: 各フォーム固有のボタン（ログインボタン/サインアップボタン）が表示される

---

## 2. チーム機能（teams.spec.ts）

### TC-TEAMS-001: チーム作成
**概要**: 新規チームを作成できることを確認

**手順**:
1. チームページ（`/teams`）に移動
2. 「チームを作成」ボタンをクリック
3. チーム作成モーダルが開くことを確認
4. チーム名（一意のタイムスタンプ付き）を入力
5. チームの説明を入力
6. 作成ボタンをクリック
7. チーム一覧に作成したチーム名が表示されることを確認
8. 作成したチームをクリック
9. `/teams/[teamID]`画面に遷移することを確認
10. タブ（出欠、メンバー、練習、大会）が表示されることを確認

**期待値**: 作成したチーム名が表示され、クリックでチーム詳細画面に遷移し、4つのタブが表示される

---

### TC-TEAMS-002: チーム参加（成功）
**概要**: アカウントAでチーム作成→アカウントBで招待コードを使って参加

**前提条件**: `E2E_EMAIL_B` / `E2E_PASSWORD_B` 環境変数が設定されていること

**手順**:
1. アカウントAでチームページに移動
2. 新しいチームを作成（または既存チームを使用）
3. チーム詳細ページで招待コードを取得
4. アカウントAからログアウト
5. アカウントBでログイン
6. チームページに移動
7. 「チームに参加」ボタンをクリック
8. 取得した招待コードを入力
9. 参加ボタンをクリック
10. チーム詳細ページに遷移し、タブが表示されることを確認

**期待値**: チーム詳細ページに遷移し、出欠・メンバータブが表示される

---

### TC-TEAMS-002-2: チーム参加（失敗）
**概要**: 無効な招待コードでエラーメッセージが表示される

**手順**:
1. チームページに移動
2. 「チームに参加」ボタンをクリック
3. 無効な招待コード（`INVALID-CODE-12345`）を入力
4. 参加ボタンをクリック
5. エラーメッセージが表示されることを確認
6. モーダルを閉じる

**期待値**: エラーメッセージが表示される

---

### TC-TEAMS-003: チーム情報編集
**概要**: 管理者がチーム名・説明を編集できることを確認

**手順**:
1. チームページに移動
2. 管理者として参加しているチームを探す
3. 管理者バッジのあるチームカードをクリック
4. チーム詳細ページで編集ボタンをクリック
5. 編集モーダル/フォームが表示されることを確認
6. チーム名を変更
7. 更新ボタンをクリック
8. 更新が完了することを確認

**期待値**: 編集モーダルが表示され、更新処理が完了する

---

### TC-TEAMS-004: チーム脱退
**概要**: チームから脱退できることを確認

**手順**:
1. チームページに移動
2. 参加しているチームを探す（管理者でないチームを優先）
3. チームカードをクリック
4. 脱退ボタンを探してクリック（確認ダイアログを受け入れ）
5. チーム一覧ページにリダイレクトされることを確認

**期待値**: URLが`/teams`に変わる

---

### TC-TEAMS-005: チーム削除
**概要**: 管理者がチームを削除できることを確認

**手順**:
1. チームページに移動
2. チーム作成ボタンがあれば新しいチームを作成、なければ既存の管理者チームを使用
3. チームの詳細ページに移動
4. 削除ボタンを探してクリック（確認ダイアログを受け入れ）
5. チーム一覧ページにリダイレクトされることを確認
6. 削除したチームが一覧に表示されないことを確認

**期待値**: URLが`/teams`に変わり、削除したチームが一覧に表示されない

---

### TC-TEAMS-006: チーム一覧表示
**概要**: 参加中のチーム一覧が正しく表示されることを確認

**手順**:
1. チームページに移動
2. 「マイチーム」見出しが表示されることを確認
3. チーム作成・参加ボタン、またはチームカードが表示されることを確認

**期待値**: チームカード、作成ボタン、参加ボタンのいずれかが表示される

---

## 3. メンバー管理（members.spec.ts）

### TC-MEMBER-001: メンバー一覧表示
**概要**: チームメンバー一覧が正しく表示されることを確認

**手順**:
1. チームページに移動し、チームを選択
2. メンバータブをクリック
3. メンバー管理コンポーネントが表示されることを確認
4. メンバーリスト（テーブルまたはリスト形式）が表示されることを確認

**期待値**: メンバー管理コンポーネントとメンバー統計/テーブルが表示される

---

### TC-MEMBER-002: メンバー詳細表示
**概要**: メンバーの詳細情報が表示されることを確認

**手順**:
1. チームのメンバータブに移動
2. メンバー管理コンポーネントが表示されるのを待つ
3. メンバー行をクリック
4. メンバー詳細モーダルが開くことを確認
5. メンバー情報（プロフィール、ベストタイムなど）が表示されていることを確認
6. 閉じるボタンをクリック
7. モーダルが閉じることを確認

**期待値**: メンバー詳細モーダルが開き、情報が表示される

---

### TC-MEMBER-003: 役割変更
**概要**: 管理者がメンバーの役割（ユーザー/管理者）を変更できることを確認

**手順**:
1. 管理者として参加しているチームのメンバータブに移動
2. 自分以外のメンバー行をクリック
3. メンバー詳細モーダルが開くことを確認
4. 役割変更トグル（ユーザー/管理者ボタン）が表示されることを確認
5. 現在の役割を確認し、逆の役割に切り替え
6. 確認ダイアログがあれば確認ボタンをクリック
7. 処理が完了するのを待つ
8. モーダルを閉じる

**期待値**: 役割変更トグルが表示され、切り替えが可能

---

### TC-MEMBER-004: メンバー削除
**概要**: 管理者がメンバーをチームから削除できることを確認（UI確認のみ）

**手順**:
1. 管理者として参加しているチームのメンバータブに移動
2. 自分以外のメンバー行をクリック
3. メンバー詳細モーダルが開くことを確認
4. 削除ボタンが表示されることを確認
5. モーダルを閉じる（実際の削除は行わない）

**期待値**: 削除ボタンが表示される

---

## 4. 出席管理（attendance.spec.ts）

### TC-ATTEND-001: 出席登録
**概要**: メンバーの出席を登録できることを確認

**手順**:
1. チームの出席タブに移動
2. 直近の出欠セクションでイベントを探す
3. 出席ボタンをクリック
4. ボタンがアクティブ状態（緑色）になることを確認
5. 保存ボタンが表示されることを確認

**期待値**: 出席ボタンがアクティブ状態になり、保存ボタンが表示される

---

### TC-ATTEND-002: 出席編集
**概要**: 登録済み出席の変更ができることを確認

**手順**:
1. チームの出席タブに移動
2. 出席/欠席/その他ボタンを探す
3. 現在の状態を確認
4. 状態を変更（出席→欠席または欠席→出席）
5. 変更後のボタン状態を確認

**期待値**: どちらかのボタンがアクティブ状態になる

---

### TC-ATTEND-003: 出席一覧表示
**概要**: 日付別出席一覧が表示されることを確認

**手順**:
1. チームの出席タブに移動
2. 月一覧が表示されることを確認（月ボタンまたは「表示できる月がありません」メッセージ）
3. 直近の出欠セクションが表示されることを確認

**期待値**: 月ボタン、エンプティメッセージ、または直近の出欠セクションが表示される

---

### TC-ATTEND-004: 出席フィルタリング
**概要**: 今月/来月タブでの切り替えが動作することを確認

**手順**:
1. チームの出席タブに移動
2. 今月/来月タブが表示されることを確認
3. 今月タブがアクティブであることを確認
4. 来月タブをクリック
5. 来月タブがアクティブになることを確認
6. 今月タブをクリックして戻る
7. 今月タブがアクティブに戻ることを確認

**期待値**: タブ切り替え時にアクティブ状態が正しく変わる

---

### TC-ATTEND-005: 月詳細モーダル表示
**概要**: 月をクリックして詳細モーダルを開けることを確認

**手順**:
1. チームの出席タブに移動
2. 月ボタンを探す
3. 最初の月ボタンをクリック
4. モーダルが開くことを確認
5. モーダル内に出席登録UI（出席/欠席/その他/保存）があることを確認
6. モーダルを閉じる

**期待値**: モーダルが開き、出席登録関連のUIが含まれる

---

## 5. スケジュール管理（schedule.spec.ts）

### TC-SCHED-001: スケジュール作成（練習記録追加）
**概要**: 新規練習記録を作成する機能のUI確認

**手順**:
1. 管理者として参加しているチームの練習タブに移動
2. 練習記録追加ボタンを探す
3. 練習記録追加ボタンをクリック
4. モーダルが開くことを確認
5. 日付入力フィールドが存在することを確認
6. モーダルを閉じる（キャンセル）

**期待値**: モーダルが開き、日付入力フィールドが存在する

---

### TC-SCHED-001-2: スケジュール作成（大会追加）
**概要**: 新規大会を作成する機能のUI確認

**手順**:
1. 管理者として参加しているチームの大会タブに移動
2. 大会追加ボタンを探す
3. 大会追加ボタンをクリック
4. モーダルが開くことを確認
5. 大会名入力フィールドが存在することを確認
6. モーダルを閉じる（キャンセル）

**期待値**: モーダルが開き、入力フィールドが存在する

---

### TC-SCHED-002: スケジュール編集（練習記録編集）
**概要**: 既存練習記録の編集画面へ遷移できることを確認

**手順**:
1. 管理者として参加しているチームの練習タブに移動
2. 練習記録を探す
3. 最初の練習記録をクリック
4. 練習ログ入力ページに遷移することを確認

**期待値**: URLに`/practices/`と`/logs`が含まれる

---

### TC-SCHED-003: スケジュール削除UI確認
**概要**: 練習/大会の削除UIが存在することを確認

**手順**:
1. チームページに移動
2. チームカードをクリック（管理者チームを優先）
3. 大会タブをクリック
4. 大会一覧を確認（「チーム大会」またはエンプティメッセージ）
5. 関連UI（記録入力、エントリー、大会追加ボタンなど）が表示されていることを確認

**期待値**: 記録入力、エントリー、大会追加ボタン、またはエンプティメッセージのいずれかが表示される

---

### TC-SCHED-004: カレンダー表示（練習一覧）
**概要**: 練習一覧が正しく表示されることを確認

**手順**:
1. チームの練習タブに移動
2. 練習一覧ヘッダー（「チーム練習記録」）が表示されることを確認
3. 練習一覧またはエンプティ状態（「練習記録がありません」）が表示されることを確認

**期待値**: 練習アイテムまたはエンプティメッセージが表示される

---

### TC-SCHED-004-2: カレンダー表示（大会一覧）
**概要**: 大会一覧が正しく表示されることを確認

**手順**:
1. チームの大会タブに移動
2. 大会一覧ヘッダー（「チーム大会」）が表示されることを確認
3. 大会一覧またはエンプティ状態（「大会がありません」）が表示されることを確認

**期待値**: 大会アイテムまたはエンプティメッセージが表示される

---

### TC-SCHED-005: エントリー管理モーダル
**概要**: 大会のエントリー管理モーダルを開けることを確認

**手順**:
1. チームの大会タブに移動
2. エントリーボタンを探す
3. エントリーボタンをクリック
4. モーダルが開くことを確認
5. モーダル内にエントリー関連のコンテンツ（「エントリー」「種目」「大会」など）があることを確認
6. モーダルを閉じる

**期待値**: モーダルが開き、エントリー関連のコンテンツが含まれる

---

## 6. 目標管理（goals.spec.ts）

### TC-GOALS-001: 目標の新規作成
**概要**: 種目・目標タイム・期限を設定して目標を作成できることを確認

**手順**:
1. 目標ページ（`/goals`）に移動
2. 「新規目標作成」ボタンをクリック
3. モーダルが開くことを確認
4. 「新規大会を作成」ラジオボタンを選択
5. 大会名を入力
6. 種目を選択
7. 目標タイムを入力
8. 作成ボタンをクリック
9. モーダルが閉じることを確認（またはバリデーションエラー時はキャンセル）
10. 目標ページにいることを確認

**期待値**: URLに`/goals`が含まれる

---

### TC-GOALS-002: 目標の編集
**概要**: 既存目標の内容を変更できることを確認

**手順**:
1. 目標ページに移動
2. 目標リストから目標を選択
3. 編集ボタンをクリック
4. 編集モーダルが開くことを確認
5. 目標タイムを変更
6. 更新ボタンをクリック
7. モーダルが閉じることを確認

**期待値**: 編集モーダルが開き、更新後に閉じる

---

### TC-GOALS-003: 目標の削除
**概要**: 目標を削除して一覧から消えることを確認

**手順**:
1. 目標ページに移動
2. 目標リストから目標を選択（削除前の目標数を記録）
3. 削除ボタンをクリック（確認ダイアログを受け入れ）
4. 目標が削除されたことを確認（目標数が減少）

**期待値**: 削除後の目標数が削除前より少ない

---

### TC-GOALS-004: 目標達成マーク
**概要**: 目標を達成済みにマークできることを確認

**手順**:
1. 目標ページに移動
2. 達成していない目標（緑色でない目標）を探す
3. 目標を選択
4. 目標詳細画面で「達成」または「目標達成」ボタンを探してクリック
5. 達成バッジが表示されることを確認

**期待値**: 「達成」テキストを含む要素が表示される

---

### TC-GOALS-005: 目標一覧表示
**概要**: 目標一覧が正しく表示されることを確認

**手順**:
1. 目標ページに移動
2. 「目標管理」見出しが表示されることを確認
3. 「新規目標作成」ボタンが表示されることを確認

**期待値**: 「目標管理」見出しと「新規目標作成」ボタンが表示される

---

## 7. マイページ（mypage.spec.ts）

### TC-MYPAGE-001: プロフィール表示
**概要**: プロフィール情報が正しく表示されることを確認

**手順**:
1. マイページ（`/mypage`）に移動
2. 「マイページ」見出しが表示されることを確認
3. 「プロフィール」セクションが表示されることを確認
4. 編集ボタンが表示されることを確認
5. プロフィール表示コンポーネントが存在することを確認

**期待値**: マイページ、プロフィールセクション、編集ボタンが表示される

---

### TC-MYPAGE-002: プロフィール編集
**概要**: 名前・自己紹介を編集できることを確認

**手順**:
1. マイページに移動
2. 編集ボタンをクリック
3. プロフィール編集モーダルが開くことを確認
4. 名前入力欄が表示されることを確認
5. 名前を変更（タイムスタンプ付きのテスト名）
6. 自己紹介を変更
7. 更新ボタンをクリック
8. モーダルが閉じることを確認

**期待値**: 編集モーダルが開き、更新後に閉じる

---

### TC-MYPAGE-003: アバター変更（UI確認）
**概要**: プロフィール画像アップロードUIが存在することを確認

**手順**:
1. マイページに移動
2. 編集ボタンをクリック
3. プロフィール編集モーダルが開くことを確認
4. 名前入力フィールド（モーダルが開いていることの確認として）が存在することを確認
5. モーダルを閉じる

**期待値**: 編集モーダル内に名前入力フィールドが存在する

---

### TC-MYPAGE-004: ベストタイム表示
**概要**: ベストタイム一覧が正しく表示されることを確認

**手順**:
1. マイページに移動
2. 「Best Time」セクションが表示されることを確認
3. 「一括入力」ボタンが表示されることを確認
4. ベストタイムテーブルまたは「記録がありません」メッセージが表示されることを確認

**期待値**: Best Timeセクション、一括入力ボタン、テーブルまたはエンプティメッセージが表示される

---

### TC-MYPAGE-005: ベストタイム一括入力ページへの遷移
**概要**: 一括入力リンクをクリックして遷移できることを確認

**手順**:
1. マイページに移動
2. 「一括入力」リンクをクリック
3. 一括入力ページ（`/bulk-besttime`）に遷移することを確認
4. ページコンテンツが表示されることを確認

**期待値**: URLに`/bulk-besttime`が含まれる

---

### TC-MYPAGE-006: チーム作成・参加ボタンの動作確認
**概要**: マイページからチーム作成・参加モーダルを開けることを確認

**手順**:
1. マイページに移動
2. チーム作成ボタンを探す
3. チーム作成ボタンが表示されている場合はクリックし、モーダルが開くことを確認して閉じる
4. チーム参加ボタンが表示されている場合はクリックし、モーダルが開くことを確認して閉じる

**期待値**: 各モーダルが開き、正しく閉じる

---

## 共通事項

### 前提条件
- 環境変数の設定: `E2E_BASE_URL`, `E2E_EMAIL`, `E2E_PASSWORD`
- テストユーザーがログイン可能な状態であること

### スキップ条件
各テストは以下の条件でスキップされる場合があります：
- 必要な環境変数が設定されていない
- 参加しているチームがない
- 管理者として参加しているチームがない
- テスト対象のデータ（目標、練習記録など）が存在しない

### ヘルパー関数
- `loginIfNeeded(page)`: ログインが必要な場合に自動ログイン
- `navigateToTeamMembersTab(page)`: チームのメンバータブに移動
- `navigateToAdminTeamMembersTab(page)`: 管理者として参加しているチームのメンバータブに移動
- `navigateToTeamAttendanceTab(page)`: チームの出席タブに移動
- `navigateToTeamPracticesTab(page)`: チームの練習タブに移動
- `navigateToAdminTeamPracticesTab(page)`: 管理者として参加しているチームの練習タブに移動
- `navigateToAdminTeamCompetitionsTab(page)`: 管理者として参加しているチームの大会タブに移動
