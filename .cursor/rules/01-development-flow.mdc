---
alwaysApply: true
---
# 開発フロー（Spec駆動+TDD）

## Spec駆動開発 + TDD の原則

**必須**: 以下の順序を厳守してください
```
1. 仕様書を読み込む（specs/配下）
   ↓
2. テストを書く（最初は必ず失敗する = Red）
   ↓
3. 実装を進める（テストが通るまで = Green）
   ↓
4. テストが通って初めてOK
   ↓
5. リファクタリング（Refactor）
```

## 詳細な開発フロー

### Phase 1: 仕様定義
```
1. 要件定義の確認
   - 何を作るのか明確にする
   
2. 仕様書作成（specs/配下）
   - 機能概要
   - UI設計（画面遷移・レイアウト）
   - データモデル（テーブル構造）
   - APIエンドポイント（GraphQL）
   - 受け入れ基準（Acceptance Criteria）
   - テストケース一覧
```

### Phase 2: 基盤構築
```
3. データベース設計
   - マイグレーションファイル作成
   - テーブル定義
   - RLSポリシー設定
   - インデックス設定
   

```

### Phase 3: TDD実践（最重要）
```
5. テスト作成（Red）
   ⚠️ 実装前にテストを書く！
   
   a) E2Eテスト（Playwright）
      - ユーザーの操作フローをテスト
      - 例: ログイン → 練習記録追加 → 確認
      
   b) 統合テスト（必要に応じて）
      - データベース操作のテスト
      
   c) ユニットテスト（必要に応じて）
      - ユーティリティ関数のテスト
      - カスタムフックのテスト
   
   ✅ テストを実行 → 必ず失敗すること（Red）を確認

6. 実装（Green）
   - テストをパスする最小限の実装
   - まずは動くコードを書く
   - テストが通るまで実装を続ける
   
   ✅ テストを実行 → 全て通ること（Green）を確認

7. リファクタリング（Refactor）
   - コードの可読性向上
   - 重複の排除
   - パフォーマンス改善
   
   ⚠️ リファクタリング中もテストが通ることを確認
```

### Phase 4: 完成
```
8. コードレビュー
   - テストが全て通っているか確認
   - コーディング規約に沿っているか確認
   
9. ドキュメント更新
   - PROJECT_STATUS.mdの更新（実装済みに変更）
   - コンポーネントドキュメント
   - API仕様書更新（必要に応じて）
```

## TDDサイクル（Red-Green-Refactor）

```
🔴 Red: テストを書く（失敗する）
   ↓
   "このテストを通すには何が必要か？"
   ↓
🟢 Green: 実装する（テストが通る）
   ↓
   "テストが通った！でもコードが汚い..."
   ↓
♻️ Refactor: リファクタリング（テストは通ったまま）
   ↓
   "コードがきれいになった！テストも通ってる！"
   ↓
   次の機能へ 🔴 Red に戻る
```

